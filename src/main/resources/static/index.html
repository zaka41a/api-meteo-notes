<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weather & Notes Demo</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; margin:2rem; line-height:1.5}
    .grid{display:grid; grid-template-columns:1fr 1fr; gap:1.5rem}
    .card{border:1px solid #e5e7eb; border-radius:14px; padding:1rem; box-shadow:0 6px 24px rgba(0,0,0,.06)}
    button,input,textarea{font:inherit}
    button{padding:.5rem .9rem; border:1px solid #d1d5db; border-radius:10px; cursor:pointer}
    input,textarea{width:100%; padding:.5rem .7rem; border:1px solid #d1d5db; border-radius:10px}
    ul{list-style:none; padding:0}
    li{display:flex; justify-content:space-between; gap:1rem; padding:.35rem 0; border-bottom:1px dashed #eee}
    code{background:#f6f6f6; padding:.15rem .35rem; border-radius:6px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <h1>üå§Ô∏è Weather & üìù Notes</h1>
  <div class="grid">
    <div class="card">
      <h2>Today's Weather</h2>
      <div id="weather">Loading‚Ä¶</div>
      <p><button id="reloadWeather">Refresh</button></p>
    </div>

    <div class="card">
      <h2>Create a note</h2>
      <form id="form">
        <label>Title<br><input id="titre" required maxlength="200"></label><br><br>
        <label>Content<br><textarea id="contenu" rows="4"></textarea></label><br><br>
        <button type="submit">Add</button>
      </form>
    </div>
  </div>

  <div class="card" style="margin-top:1.5rem">
    <h2>Notes</h2>
    <ul id="notes"></ul>
  </div>

  <script>
    async function getJSON(url, opts){ const r=await fetch(url, opts); if(!r.ok) throw new Error(`${r.status} ${r.statusText}`); return r.json(); }

    async function loadWeather(){
      const w = document.getElementById('weather');
      try{
        const j = await getJSON('/meteo');
        w.innerHTML = `
          <div>Date: <b>${j.date}</b></div>
          <div>City: <b>${j.ville}</b></div>
          <div>Temperature: <b>${j.temperature_c} ¬∞C</b></div>
          <div>Condition: <b>${j.condition}</b></div>
          <div>Humidity: <b>${j.humidite_pct} %</b></div>
        `;
      }catch(e){ w.textContent = 'Error: ' + e.message; }
    }
    document.getElementById('reloadWeather').onclick = loadWeather;

    async function loadNotes(){
      const ul = document.getElementById('notes');
      ul.innerHTML = 'Loading‚Ä¶';
      try{
        const list = await getJSON('/notes');
        if(!list.length){ ul.innerHTML = '<i>No notes</i>'; return; }
        ul.innerHTML = '';
        for(const n of list){
          const li = document.createElement('li');
          li.innerHTML = `<div><b>${n.titre}</b><br><small>${(n.contenu||'').replaceAll('<','&lt;')}</small></div>
                          <div><button data-id="${n.id}">Delete</button></div>`;
          li.querySelector('button').onclick = async (e)=>{
            if(!confirm('Delete this note?')) return;
            await fetch('/notes/'+n.id, {method:'DELETE'});
            loadNotes();
          };
          ul.appendChild(li);
        }
      }catch(e){ ul.textContent = 'Error: ' + e.message; }
    }

    document.getElementById('form').onsubmit = async (ev)=>{
      ev.preventDefault();
      const titre = document.getElementById('titre').value.trim();
      const contenu = document.getElementById('contenu').value;
      if(!titre){ alert('Title is required'); return; }
      await fetch('/notes', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({titre, contenu})});
      ev.target.reset();
      loadNotes();
    };

    loadWeather(); loadNotes();
  </script>
</body>
</html>
